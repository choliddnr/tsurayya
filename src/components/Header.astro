---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import NavDropdown from './NavDropdown.astro';
import NavDropdownMobile from './NavDropdownMobile.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const solutionDescription = {
  primary:
    'We craft scalable digital solutions tailored to real-world business challenges.',
  secondary:
    'From websites to AI-powered systems, our solutions are built to solve problems and deliver results.',
};
const solutionsContent = [
  {
    title: 'AI & Automation',
    href: `/${lang}/services`,
    description: 'Boost efficiency with smart chatbots and workflows.',
  },
  {
    title: 'Web Development',
    href: `/${lang}/services`,
    description: 'Custom websites and web apps tailored to your goals.',
  },
  {
    title: 'Infrastructure',
    href: `/${lang}/services`,
    description: 'Reliable, secure, and scalable system setups.',
  },
  {
    title: 'Business Tools',
    href: `/${lang}/services`,
    description: 'Lead gen, client portals, and internal dashboards.',
  },
];

const technologiesDescription = {
  primary: 'We choose proven, modern technologies trusted by the industry.',
  secondary:
    'Our stack is carefully selected for performance, scalability, and long-term reliability.',
};
const technologiesContent = [
  {
    title: 'Frontend',
    href: `/${lang}/technologies`,
    description:
      'Nuxt 3, Vue3, Astrojs, Tailwind CSS, AlpineJS â€” fast & responsive.',
  },
  {
    title: 'Backend',
    href: `/${lang}/technologies`,
    description: 'Node.js, Bun, PocketBase for powerful APIs.',
  },
  {
    title: 'AI Tools',
    href: `/${lang}/technologies`,
    description: 'GPT, n8n, Langchain for automation and insight.',
  },
  {
    title: 'DevOps & Infra',
    href: `/${lang}/technologies`,
    description: 'Docker, Nginx, Kubernetes for modern deployment.',
  },
];

const companyDescription = {
  primary: 'Tsurayya Engineering is your partner in digital innovation.',
  secondary: `Learn more about Tsurayya Engineering, our mission, how we work, and what we've done.`,
};
const companyContent = [
  {
    title: 'About Us',
    href: `/${lang}/about`,
    description: 'Our vision, mission, and core values.',
  },
  {
    title: 'Our Work',
    href: `/${lang}/work`,
    description: 'Knowing what we have done.',
  },
  {
    title: 'Our Blog',
    href: `/${lang}/blog`,
    description: 'Sharing out knowladge about tech, business, and more.',
  },
  {
    title: 'Industries We Serve',
    href: `/${lang}/industries`,
    description: 'We serve diverse industries with custom-fit digital tools..',
  },
  {
    title: 'Contact Us',
    href: `/${lang}/contact`,
    description: 'Start a conversation with us today.',
  },
];
---

<header
  id="main-header"
  class="bg-dark sticky top-0 z-50 transition-transform duration-500 ease-in-out"
>
  <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
    <div class="text-2xl font-bold">
      <a href={'/' + lang} class="text-white text-2xl font-bold flex flex-row"
        ><img
          src="/favicon.svg"
          alt="tsurayya engineering"
          class="size-8"
        />Tsurayya<span class="gradient-text">Engineering</span></a
      >
    </div>
    <div class="hidden lg:flex space-x-4 items-center">
      <NavDropdown
        title={t('nav.solutions')}
        content={solutionsContent}
        description={solutionDescription}
      />
      <NavDropdown
        title={t('nav.technologies')}
        content={technologiesContent}
        description={technologiesDescription}
      />
      <NavDropdown
        title={t('nav.company')}
        content={companyContent}
        description={companyDescription}
      />

      <div
        class="flex items-center space-x-2 px-4 py-2 rounded-full border border-white/20"
      >
        <a
          href={Astro.url.pathname.replace(`/${lang}`, '/en')}
          class={` ${lang === 'en' ? 'font-bold text-[var(--color-accent)]' : 'text-white'} `}
        >
          EN
        </a>
        <span class="text-white">|</span>
        <a
          href={Astro.url.pathname.replace(`/${lang}`, '/id')}
          class={` ${lang === 'id' ? 'font-bold text-[var(--color-accent)]' : 'text-white'} `}
        >
          ID
        </a>
      </div>
      <a
        href={'/' + lang + '/contact'}
        class="bg-[var(--color-accent)] text-dark px-3 py-2 rounded-full hover:opacity-90 cyber-button"
        >{t('nav.contact')}</a
      >
    </div>
    <div class="lg:hidden flex items-center gap-5">
      <div class="flex items-center space-x-2 px-3 py-2">
        <a
          href={Astro.url.pathname.replace(`/${lang}`, '/en')}
          class={` ${lang === 'en' ? 'font-bold text-[var(--color-accent)]' : 'text-white'} `}
        >
          EN
        </a>
        <span class="text-white">|</span>
        <a
          href={Astro.url.pathname.replace(`/${lang}`, '/id')}
          class={` ${lang === 'id' ? 'font-bold text-[var(--color-accent)]' : 'text-white'}`}
        >
          ID
        </a>
      </div>
      <button id="mobile-menu-button" class="text-white focus:outline-none">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"></path></svg
        >
      </button>
    </div>
  </nav>
  <div id="mobile-menu" class="md:hidden" style="display: none;">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <NavDropdownMobile
        title={t('nav.solutions')}
        content={solutionsContent}
        description={solutionDescription}
      />
      <NavDropdownMobile
        title={t('nav.technologies')}
        content={technologiesContent}
        description={technologiesDescription}
      />
      <NavDropdownMobile
        title={t('nav.company')}
        content={companyContent}
        description={companyDescription}
      />

      <a
        href={'/' + lang + '/contact'}
        class="bg-[var(--color-accent)] text-dark block px-3 py-2 rounded-full text-center text-base font-medium hover:opacity-90 cyber-button"
        >{t('nav.contact')}</a
      >
    </div>
  </div>
</header>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // Scroll behavior
    const header = document.getElementById('main-header');
    if (header) {
      let lastScrollTop = 0;
      const scrollThreshold = 50;
      header.classList.remove('-translate-y-full');
      window.addEventListener('scroll', () => {
        const currentScroll =
          window.pageYOffset || document.documentElement.scrollTop;
        if (currentScroll > lastScrollTop && currentScroll > scrollThreshold) {
          header.classList.add('-translate-y-full');
          header.classList.remove('shadow-lg');
        } else if (
          currentScroll < lastScrollTop &&
          currentScroll > scrollThreshold
        ) {
          header.classList.remove('-translate-y-full');
          header.classList.add('shadow-lg');
        } else if (currentScroll <= scrollThreshold) {
          header.classList.remove('-translate-y-full');
          header.classList.remove('shadow-lg');
        }
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
      });
    }

    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => {
        const isMenuOpen = mobileMenu.style.display === 'block';
        mobileMenu.style.display = isMenuOpen ? 'none' : 'block';
      });
    }
  });
</script>
